<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - QueueFlow</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/premium.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-mode.css') }}">
    <meta http-equiv="refresh" content="15">
    <script src="{{ url_for('static', filename='js/dark-mode.js') }}"></script>
</head>
<body class="page-content">
    <!-- Premium Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="#">
                <span class="gradient-text">{{ center.name }}</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center gap-2">
                    <li class="nav-item"><a href="{{ url_for('admin_analytics') }}" class="btn btn-sm btn-primary">üìà Analytics</a></li>
                    <li class="nav-item"><a href="{{ url_for('add_walkin') }}" class="btn btn-sm btn-outline-primary">üö∂ Add Walk-In</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">‚öôÔ∏è Menu</a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{{ url_for('admin_profile') }}">üë§ Profile</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('admin_history') }}">üìú History</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <form method="POST" action="{{ url_for('admin_delete_center') }}" style="margin: 0;"
                                      onsubmit="return confirm('Are you sure you want to delete your service center? This action cannot be undone!')">
                                    <button type="submit" class="dropdown-item text-danger">üóëÔ∏è Delete Center</button>
                                </form>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item"><a href="{{ url_for('admin_logout') }}" class="btn btn-sm btn-outline-primary">Logout</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-4 py-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show fade-in-up" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="row g-4">
            <!-- Counter 1: Online Queue -->
            <div class="col-lg-6">
                <div class="card hover-lift mb-3" style="border-left: 4px solid var(--primary-color);">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4" style="color: var(--primary-color);">üíª Counter 1: Online Queue</h5>
                        {% if serving_token %}
                            <div class="text-center mb-3">
                                <div class="token-display" style="font-size: 5rem;">{{ serving_token.token_number }}</div>
                                <h6 class="mt-2 fw-semibold">{{ serving_token.user.name }}</h6>
                                <p class="text-muted text-sm mb-3">üì± {{ serving_token.user.mobile }}</p>
                                <div class="d-grid gap-2">
                                    <a href="{{ url_for('complete_token', token_id=serving_token.id) }}" class="btn btn-success">‚úì Complete</a>
                                    <a href="{{ url_for('no_show', token_id=serving_token.id) }}" class="btn btn-danger">‚úó No Show</a>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center py-5 text-muted">
                                <div style="font-size: 3rem; opacity: 0.3;">üö´</div>
                                <p class="mb-0">No Token Serving</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                {% if can_call_next %}
                    <a href="{{ url_for('call_next') }}" class="btn btn-call-next w-100 mb-3">üì¢ Call Next: {{ next_eligible_token.token_number if next_eligible_token else 'Ready' }}</a>
                {% else %}
                    <button class="btn btn-secondary w-100 mb-3" disabled style="padding: 18px; font-size: 1.25rem; border-radius: var(--radius-lg);">‚è≥ Waiting for User Arrival</button>
                {% endif %}

                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%); color: #0F172A; font-weight: 700;">
                        <h6 class="mb-0">üìã Waiting Queue ({{ waiting_tokens|length }})</h6>
                    </div>
                    <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
                        {% if waiting_tokens %}
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Token</th>
                                        <th>Name</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in waiting_tokens %}
                                    <tr>
                                        <td>
                                            <span class="fw-bold" style="color: #2DD4BF;">{{ item.token.token_number }}</span>
                                            {% if item.status_badge == 'Travelling' %}
                                                <span class="badge bg-info ms-2">üöó Travelling</span>
                                            {% elif item.status_badge == 'Arrived' %}
                                                <span class="badge bg-success ms-2">‚úÖ Arrived</span>
                                            {% elif item.status_badge == 'Late' %}
                                                <span class="badge bg-danger ms-2">‚ö†Ô∏è Late</span>
                                            {% endif %}
                                        </td>
                                        <td class="fw-semibold">{{ item.token.user.name }}</td>
                                        <td><a href="{{ url_for('no_show', token_id=item.token.id) }}" class="btn btn-sm btn-outline-danger">No Show</a></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <div class="text-center py-4 text-muted"><p class="mb-0">No tokens waiting</p></div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Counter 2: Walk-In Queue -->
            <div class="col-lg-6">
                <div class="card hover-lift mb-3" style="border-left: 4px solid var(--primary-color);">
                    <div class="card-body p-4">
                        <h5 class="fw-bold mb-4" style="color: var(--primary-color);">üö∂ Counter 2: Walk-In Queue</h5>
                        {% if walkin_serving_token %}
                            <div class="text-center mb-3">
                                <div class="token-display" style="font-size: 5rem;">{{ walkin_serving_token.token_number }}</div>
                                <h6 class="mt-2 fw-semibold">{{ walkin_serving_token.user.name }}</h6>
                                <p class="text-muted text-sm mb-3">üì± {{ walkin_serving_token.user.mobile }}</p>
                                <div class="d-grid gap-2">
                                    <a href="{{ url_for('complete_token', token_id=walkin_serving_token.id) }}" class="btn btn-success">‚úì Complete</a>
                                    <a href="{{ url_for('no_show', token_id=walkin_serving_token.id) }}" class="btn btn-danger">‚úó No Show</a>
                                </div>
                            </div>
                        {% else %}
                            <div class="text-center py-5 text-muted">
                                <div style="font-size: 3rem; opacity: 0.3;">üö´</div>
                                <p class="mb-0">No Token Serving</p>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <a href="{{ url_for('call_next_walkin') }}" class="btn btn-call-next w-100 mb-3">üì¢ Call Next (Walk-In)</a>

                <div class="card">
                    <div class="card-header" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%); color: #0F172A; font-weight: 700;">
                        <h6 class="mb-0">üìã Waiting Queue ({{ walkin_waiting_tokens|length }})</h6>
                    </div>
                    <div class="card-body p-0" style="max-height: 400px; overflow-y: auto;">
                        {% if walkin_waiting_tokens %}
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th>Token</th>
                                        <th>Name</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for token in walkin_waiting_tokens %}
                                    <tr>
                                        <td><span class="fw-bold" style="color: #2DD4BF;">{{ token.token_number }}</span></td>
                                        <td class="fw-semibold">{{ token.user.name }}</td>
                                        <td><a href="{{ url_for('no_show', token_id=token.id) }}" class="btn btn-sm btn-outline-danger">No Show</a></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        {% else %}
                            <div class="text-center py-4 text-muted"><p class="mb-0">No walk-in tokens waiting</p></div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center mt-4">
            <small class="text-muted">‚è±Ô∏è Page auto-refreshes every 15 seconds</small>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/premium-animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme-toggle.js') }}"></script>
    <button id="theme-toggle" class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme" style="position: fixed; bottom: 2rem; right: 2rem; width: 56px; height: 56px; border-radius: 50%; background: linear-gradient(135deg, #2DD4BF, #14B8A6); border: none; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; z-index: 9999; transition: all 0.3s ease;">üåô</button>
</body>
</html>
