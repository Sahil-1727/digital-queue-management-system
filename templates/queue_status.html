<!DOCTYPE html>
<html lang="en">
<head>
  <script>
  (function() {
    const saved = localStorage.getItem('queueflow-theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (saved === 'dark' || (!saved && prefersDark)) {
      document.documentElement.setAttribute('data-theme', 'dark');
    }
  })();
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Queue Status - QueueFlow</title>
  <meta name="description" content="Track your real-time queue status on QueueFlow. See your position, estimated wait time, and suggested leave time.">
  <link rel="canonical" href="{{ request.url }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/enhancements.css') }}">
  <meta http-equiv="refresh" content="30">
  <style>
    .notification-bell {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 48px;
      height: 48px;
      background: var(--color-primary);
      color: var(--text-inverse);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      box-shadow: var(--shadow-lg);
      cursor: pointer;
      transition: all var(--transition-base);
      z-index: 1000;
    }
    
    .notification-bell:hover {
      transform: scale(1.1);
      box-shadow: var(--shadow-xl);
    }
    
    .token-card {
      background: linear-gradient(135deg, var(--color-primary), var(--color-primary-dark));
      color: var(--text-inverse);
      border-radius: var(--radius-xl);
      padding: var(--space-xl);
      text-align: center;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }
    
    .token-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
      animation: pulse-glow 3s ease-in-out infinite;
    }
    
    .token-display {
      font-size: clamp(4rem, 10vw, 7rem);
      font-weight: 800;
      line-height: 1;
      position: relative;
      z-index: 1;
    }
    
    .text-sm {
      font-size: 0.875rem;
    }
  </style>
</head>
<body class="page-content" style="background: var(--bg-soft);">
  <a href="#main-content" style="position:absolute;top:-100px;left:0;z-index:9999;padding:8px 16px;background:var(--color-primary);color:white;border-radius:0 0 8px 0;transition:top 0.2s ease;font-weight:600;text-decoration:none;" onfocus="this.style.top='0'" onblur="this.style.top='-100px'">Skip to main content</a>
  <div class="notification-bell" id="notification-bell" onclick="document.getElementById('notification-alert').scrollIntoView({behavior: 'smooth'})" aria-label="View notifications">üîî</div>
  
  <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container d-flex align-items-center justify-content-between">
      <a class="navbar-brand fw-bold" href="{{ url_for('services') }}">
        <span class="gradient-text">Queue</span>Flow
      </a>
      <div style="display:flex;align-items:center;gap:10px;">
        <button id="dark-mode-toggle" onclick="toggleDarkMode()" style="width:38px;height:38px;border-radius:50%;border:1px solid rgba(255,255,255,0.3);background:transparent;cursor:pointer;font-size:1rem;display:inline-flex;align-items:center;justify-content:center;transition:all 0.2s ease;" aria-label="Toggle dark mode">‚òÄÔ∏è</button>
        <a href="{{ url_for('services') }}" class="btn btn-sm btn-outline-primary hover-scale">‚Üê Back to Services</a>
      </div>
    </div>
  </nav>

  <div class="container py-5" id="main-content">
    <div class="row justify-content-center">
      <div class="col-md-10">
        <div class="card hover-lift fade-in-up">
          <div class="card-body p-4 p-md-5">
            <div class="text-center mb-4">
              <h4 class="fw-bold">{{ token.service_center.name }}</h4>
              <p class="text-muted">üìç {{ token.service_center.location }}</p>
            </div>
            
            <div class="token-card mb-4">
              <p class="text-sm mb-2" style="opacity: 0.9;">Your Token Number</p>
              <h1 class="token-display mb-0">{{ token.token_number }}</h1>
            </div>

            <div class="row g-3 mb-4 stagger-animation">
              <div class="col-md-4">
                <div class="stat-card-enhanced text-center">
                  <h2 class="display-5 fw-bold mb-2">{% if serving_token %}{{ serving_token.token_number }}{% else %}--{% endif %}</h2>
                  <small class="fw-semibold text-muted">Currently Serving</small>
                </div>
              </div>
              <div class="col-md-4">
                <div class="queue-position-card">
                  <h2 class="display-5 fw-bold mb-2">{{ position }}</h2>
                  <small class="fw-semibold">People Ahead</small>
                </div>
              </div>
              <div class="col-md-4">
                <div class="stat-card-enhanced text-center">
                  <h2 class="display-5 fw-bold mb-2">~{{ wait_time }}</h2>
                  <small class="fw-semibold text-muted">Minutes Wait</small>
                </div>
              </div>
            </div>
            
            <div id="queue-speed-indicator" class="alert alert-success mb-3 fade-in-up" style="display: none;">
              <h6 class="fw-bold mb-2">‚ö° Queue Speed Status</h6>
              <p class="mb-0" id="queue-speed-message"></p>
            </div>

            {% if token.status == 'Active' and position > 0 %}
            <div class="alert alert-success mb-3 fade-in-up">
              <h5 class="text-center fw-bold mb-2">üè† Suggested Leave Time</h5>
              <h2 class="text-center display-4 fw-bold mb-2">{{ leave_time.strftime('%I:%M %p') }}</h2>
              <p class="text-center mb-1">Leave home around this time to avoid waiting</p>
              {% if travel_time %}
              <p class="text-center mb-0 small">üöó Travel time: ~{{ travel_time }} mins</p>
              {% endif %}
            </div>
            <div class="alert alert-info mb-3 fade-in-up">
              <h6 class="text-center fw-bold mb-2">üìÖ {{ reach_counter_time.strftime('%d %B %Y') }}</h6>
              <h6 class="text-center fw-bold mb-2">‚è∞ Approx. Time to Reach Counter</h6>
              <h3 class="text-center fw-bold mb-0">{{ reach_counter_time.strftime('%I:%M %p') }}</h3>
            </div>
            
            <div id="notification-alert" class="alert alert-warning mb-3 fade-in-up" style="display: none;">
              <h6 class="text-center fw-bold mb-2">üîî Notification</h6>
              <p class="text-center mb-0 fw-semibold" id="notification-message"></p>
            </div>
            {% elif token.status == 'Serving' %}
            <div class="alert alert-warning fade-in-up">
              <h4 class="text-center fw-bold mb-2">üîî Your Turn!</h4>
              <p class="text-center mb-0 fw-semibold">Please proceed to the service counter</p>
            </div>
            {% elif token.status == 'Completed' %}
            <div class="alert alert-success fade-in-up">
              <h4 class="text-center fw-bold mb-2">‚úÖ Service Completed</h4>
              <p class="text-center mb-0 fw-semibold">Thank you for using QueueFlow!</p>
            </div>
            {% elif token.status == 'Expired' %}
            <div class="alert alert-danger fade-in-up">
              <h4 class="text-center fw-bold mb-2">‚ùå Token Expired</h4>
              <p class="text-center mb-0 fw-semibold">This token is no longer valid</p>
            </div>
            {% endif %}

            <div class="text-center mt-4">
              <span class="badge {% if token.status == 'Active' %}badge-primary{% elif token.status == 'Serving' %}badge-warning{% elif token.status == 'Completed' %}badge-success{% else %}badge-danger{% endif %}" style="padding: 12px 28px; font-size: 1.125rem;">
                Status: {{ token.status }}
              </span>
            </div>

            <p class="text-center text-muted mt-4 mb-0">
              <small class="d-flex align-items-center justify-content-center gap-2">
                <span class="spinner-border spinner-border-sm" style="width: 12px; height: 12px;"></span>
                <span>‚è±Ô∏è Page auto-refreshes every 30 seconds</span>
              </small>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
  <script>
    (function() {
      const theme = localStorage.getItem('queueflow-theme');
      if (theme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        const btn = document.getElementById('dark-mode-toggle');
        if (btn) btn.textContent = 'üåô';
      }
    })();
    
    function toggleDarkMode() {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      if (isDark) {
        document.documentElement.removeAttribute('data-theme');
        localStorage.setItem('queueflow-theme', 'light');
        document.querySelectorAll('#dark-mode-toggle').forEach(btn => btn.textContent = '‚òÄÔ∏è');
      } else {
        document.documentElement.setAttribute('data-theme', 'dark');
        localStorage.setItem('queueflow-theme', 'dark');
        document.querySelectorAll('#dark-mode-toggle').forEach(btn => btn.textContent = 'üåô');
      }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
      document.querySelectorAll('#dark-mode-toggle').forEach(btn => {
        btn.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      });
    });
  </script>
</body>
</html>
