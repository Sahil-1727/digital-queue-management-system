<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queue Status - QueueFlow</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
    
    
    <meta http-equiv="refresh" content="30">
    <style>
        .notification-bell { position: fixed; top: 20px; right: 20px; width: 60px; height: 60px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 50%; display: none; align-items: center; justify-content: center; font-size: 30px; box-shadow: 0 10px 30px rgba(245, 158, 11, 0.5); animation: shake 0.5s infinite; z-index: 9999; cursor: pointer; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    </style>
    </head>
<body class="page-content" style="background: var(--bg-soft);">
    <div class="notification-bell" id="notification-bell" onclick="document.getElementById('notification-alert').scrollIntoView({behavior: 'smooth'})">üîî</div>
    
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="{{ url_for('services') }}">
                <span class="gradient-text">Queue</span>Flow
            </a>
            <a href="{{ url_for('services') }}" class="btn btn-sm btn-outline-primary">‚Üê Back to Services</a>
        </div>
    </nav>

    <div class="container py-5">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card hover-lift fade-in-up">
                    <div class="card-body p-5">
                        <div class="text-center mb-4">
                            <h4 class="fw-bold">{{ token.service_center.name }}</h4>
                            <p class="text-muted">üìç {{ token.service_center.location }}</p>
                        </div>
                        
                        <div class="token-card mb-4">
                            <p class="text-muted text-sm mb-2">Your Token Number</p>
                            <h1 class="token-display mb-0">{{ token.token_number }}</h1>
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-4">
                                <div class="stat-card text-center">
                                    <h2 class="display-5 fw-bold mb-2">{% if serving_token %}{{ serving_token.token_number }}{% else %}--{% endif %}</h2>
                                    <small class="fw-semibold">Currently Serving</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center hover-lift" style="background: var(--bg-card); border: 2px solid var(--color-primary);">
                                    <div class="card-body py-4">
                                        <h2 class="display-5 fw-bold mb-2 gradient-text">{{ position }}</h2>
                                        <small class="fw-semibold">People Ahead</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center hover-lift">
                                    <div class="card-body py-4">
                                        <h2 class="display-5 fw-bold mb-2">~{{ wait_time }}</h2>
                                        <small class="fw-semibold">Minutes Wait</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="queue-speed-indicator" class="alert alert-success mb-3" style="display: none;">
                            <h6 class="fw-bold mb-2">‚ö° Queue Speed Status</h6>
                            <p class="mb-0" id="queue-speed-message"></p>
                        </div>

                        {% if token.status == 'Active' and position > 0 %}
                            <div class="alert alert-success mb-3">
                                <h5 class="text-center fw-bold mb-2">üè† Suggested Leave Time</h5>
                                <h2 class="text-center display-4 fw-bold mb-2">{{ leave_time.strftime('%I:%M %p') }}</h2>
                                <p class="text-center mb-1">Leave home around this time to avoid waiting</p>
                                {% if travel_time %}
                                <p class="text-center mb-0 small">üöó Travel time: ~{{ travel_time }} mins</p>
                                {% endif %}
                            </div>
                            <div class="alert alert-info mb-3">
                                <h6 class="text-center fw-bold mb-2">üìÖ {{ reach_counter_time.strftime('%d %B %Y') }}</h6>
                                <h6 class="text-center fw-bold mb-2">‚è∞ Approx. Time to Reach Counter</h6>
                                <h3 class="text-center fw-bold mb-0">{{ reach_counter_time.strftime('%I:%M %p') }}</h3>
                            </div>
                            
                            <div id="notification-alert" class="alert alert-warning mb-3" style="display: none;">
                                <h6 class="text-center fw-bold mb-2">üîî Notification</h6>
                                <p class="text-center mb-0 fw-semibold" id="notification-message"></p>
                            </div>
                        {% elif token.status == 'Serving' %}
                            <div class="alert alert-warning">
                                <h4 class="text-center fw-bold mb-2">üîî Your Turn!</h4>
                                <p class="text-center mb-0 fw-semibold">Please proceed to the service counter</p>
                            </div>
                        {% elif token.status == 'Completed' %}
                            <div class="alert alert-success">
                                <h4 class="text-center fw-bold mb-2">‚úÖ Service Completed</h4>
                                <p class="text-center mb-0 fw-semibold">Thank you for using QueueFlow!</p>
                            </div>
                        {% elif token.status == 'Expired' %}
                            <div class="alert alert-danger">
                                <h4 class="text-center fw-bold mb-2">‚ùå Token Expired</h4>
                                <p class="text-center mb-0 fw-semibold">This token is no longer valid</p>
                            </div>
                        {% endif %}

                        <div class="text-center mt-4">
                            <span class="badge {% if token.status == 'Active' %}badge-primary{% elif token.status == 'Serving' %}badge-warning{% elif token.status == 'Completed' %}badge-success{% else %}badge-danger{% endif %}" style="padding: 12px 28px; font-size: 1.125rem;">
                                Status: {{ token.status }}
                            </span>
                        </div>

                        <p class="text-center text-muted mt-4 mb-0">
                            <small>‚è±Ô∏è Page auto-refreshes every 30 seconds</small>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script>
